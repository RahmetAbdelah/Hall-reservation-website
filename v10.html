<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AASTU Room Reservation System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>


  <style>
    /* ---------- Base ---------- */
    body {
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease;
      font-size: 15px;
      line-height: 1.6;
    }

    /* ---------- Dark Mode ---------- */
    .dark-mode {
      background-color: #181818 !important;
      color: #e5e5e5 !important;
    }

    .dark-mode .bg-white {
      background-color: #262626 !important;
      color: #e5e5e5 !important;
    }

    .dark-mode .text-gray-800 {
      color: #e5e5e5 !important;
    }

    .dark-mode .text-gray-700 {
      color: #d4d4d4 !important;
    }

    .dark-mode .text-gray-600 {
      color: #bdbdbd !important;
    }

    .dark-mode .text-gray-500 {
      color: #9e9e9e !important;
    }

    .dark-mode .border-gray-200,
    .dark-mode .border-gray-300 {
      border-color: #3f3f3f !important;
    }

    .dark-mode .divide-gray-200 > * {
      border-color: #3f3f3f !important;
    }

    .dark-mode .bg-indigo-50,
    .dark-mode .bg-yellow-50,
    .dark-mode .bg-green-50,
    .dark-mode .bg-red-50,
    .dark-mode .bg-blue-50,
    .dark-mode .bg-gray-50 {
      background-color: #2f2f2f !important;
    }

    .dark-mode input,
    .dark-mode textarea,
    .dark-mode select {
      background-color: #2f2f2f !important;
      color: #ffffff !important;
      border-color: #444 !important;
    }

    /* ---------- Typography (calmer & modern) ---------- */
    h1 { font-size: 1.75rem; font-weight: 600; }
    h2 { font-size: 1.4rem; font-weight: 600; }
    h3 { font-size: 1rem; font-weight: 500; }

    p {
      font-size: 0.9rem;
      color: inherit;
    }

    /* ---------- Cards ---------- */
    .card-hover {
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      border-radius: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
    }

    .card-hover:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }

    /* ---------- Stats / Blocks ---------- */
    .stat-card {
      transition: transform 0.25s ease;
      border-radius: 14px;
    }

    .stat-card:hover {
      transform: scale(1.015);
    }

    /* ---------- Images ---------- */
    .room-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* ---------- Buttons ---------- */
    .favorite-btn {
      transition: transform 0.2s ease;
    }

    .favorite-btn:hover {
      transform: scale(1.08);
    }

    /* ---------- Theme Toggle ---------- */
    .theme-toggle {
      cursor: pointer;
      font-size: 20px;
      padding: 6px 10px;
      background-color: #f3f4f6;
      border-radius: 10px;
      transition: all 0.25s ease;
      user-select: none;
    }

    .theme-toggle:hover {
      background-color: #e5e7eb;
      transform: scale(1.05);
    }

    .dark-mode .theme-toggle {
      background-color: #2f2f2f;
    }

    .dark-mode .theme-toggle:hover {
      background-color: #3a3a3a;
    }

    /* ---------- Loading ---------- */
    
    
    .loading-spinner {
      border: 3px solid #e5e7eb;
      border-top: 3px solid #2563eb;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ---------- Toast ---------- */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 14px 20px;
      border-radius: 10px;
      color: white;
      font-size: 0.9rem;
      font-weight: 500;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(300px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast-success { background-color: #10b981; }
    .toast-error { background-color: #ef4444; }
    .toast-info { background-color: #3b82f6; }
  </style>
    
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto" style="background-color: #f0f4f8;"><!-- Content will be rendered here -->
  </div>
  <script>
        let isDarkMode = false;

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.getElementById('app').classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
        }

        // Load saved theme preference
        function loadThemePreference() {
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                isDarkMode = true;
                document.getElementById('app').classList.add('dark-mode');
            }
        }

        // University branding
        const universityHeader = `
            <div class="flex flex-col">
                <h1 class="text-2xl font-bold text-indigo-600">Addis Ababa Science and Technology University</h1>
                <p class="text-sm text-gray-600 italic">University for Industry</p>
            </div>
        `;

        // LocalStorage wrapper to simulate Data SDK
        class LocalStorageDB {
            constructor() {
                this.storageKey = 'roomReservationData';
            }

            getData() {
                const data = localStorage.getItem(this.storageKey);
                return data ? JSON.parse(data) : [];
            }

            saveData(data) {
                localStorage.setItem(this.storageKey, JSON.stringify(data));
            }

            create(item) {
                const data = this.getData();
                data.push(item);
                this.saveData(data);
                return true;
            }

            update(item) {
                const data = this.getData();
                const index = data.findIndex(d => d.id === item.id);
                if (index !== -1) {
                    data[index] = item;
                    this.saveData(data);
                    return true;
                }
                return false;
            }

            delete(item) {
                const data = this.getData();
                const filtered = data.filter(d => d.id !== item.id);
                this.saveData(filtered);
                return true;
            }
        }

        const db = new LocalStorageDB();
        let allData = [];
        let currentUser = null;
        let currentView = 'login';
        let searchQuery = '';
        let filterBuilding = 'all';
        let filterCapacity = 'all';
        let sortBy = 'name';

        function loadData() {
            allData = db.getData();
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function getUsers() {
            return allData.filter(item => item.type === 'user');
        }

        function getRooms() {
            return allData.filter(item => item.type === 'room');
        }

        function getBookings() {
            return allData.filter(item => item.type === 'booking');
        }

        function getFilteredRooms() {
            let rooms = getRooms();
            
            // Get all approved bookings
            const approvedBookings = getBookings().filter(b => b.status === 'approved');
            const bookedRoomIds = approvedBookings.map(b => b.roomId);
            
            // Filter out rooms that have approved bookings
            rooms = rooms.filter(room => !bookedRoomIds.includes(room.id));
            
            if (searchQuery) {
                rooms = rooms.filter(room => 
                    room.roomName.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    room.description?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    room.equipment.toLowerCase().includes(searchQuery.toLowerCase())
                );
            }
            
            if (filterBuilding !== 'all') {
                rooms = rooms.filter(room => room.building === filterBuilding);
            }
            
            if (filterCapacity !== 'all') {
                const cap = parseInt(filterCapacity);
                rooms = rooms.filter(room => room.capacity >= cap);
            }
            
            rooms.sort((a, b) => {
                if (sortBy === 'name') return a.roomName.localeCompare(b.roomName);
                if (sortBy === 'capacity') return b.capacity - a.capacity;
                if (sortBy === 'building') return (a.building || '').localeCompare(b.building || '');
                return 0;
            });
            
            return rooms;
        }

        function getFavoriteRooms() {
            if (!currentUser) return [];
            return allData.filter(item => 
                item.type === 'favorite' && 
                item.studentEmail === currentUser.email
            );
        }

        function isRoomFavorite(roomId) {
            if (!currentUser) return false;
            return getFavoriteRooms().some(fav => fav.roomId === roomId);
        }

        function renderCurrentView() {
            const app = document.getElementById('app');

            if (currentView === 'login') {
                app.innerHTML = renderLoginPage();
            } else if (currentView === 'register') {
                app.innerHTML = renderRegisterPage();
            } else if (currentView === 'admin') {
                app.innerHTML = renderAdminDashboard();
            } else if (currentView === 'student') {
                app.innerHTML = renderStudentDashboard();
            }
        }

        function renderLoginPage() {
            return `
                <div class="min-h-full flex items-center justify-center p-6">
                    <div class="bg-white w-full max-w-md p-8 rounded-xl shadow-2xl">
                        <div class="text-center mb-8">
                            <h1 class="text-2xl font-bold text-indigo-600 mb-2">Addis Ababa Science and Technology University</h1>
                            <p class="text-sm text-gray-600 italic mb-4">University for Industry</p>
                            <p class="text-lg text-indigo-600 font-semibold mb-3">Room Reservation System</p>
                            <p class="text-gray-600 text-sm">Welcome! Please sign in to continue</p>
                        </div>
                        
                        <form id="login-form" class="space-y-4">
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Email</label>
                                <input type="email" id="login-email" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Password</label>
                                <input type="password" id="login-password" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition shadow-lg">
                                Sign In
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center">
                            <button onclick="switchToRegister()" class="text-indigo-600 hover:underline font-medium">
                                Don't have an account? Register
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRegisterPage() {
            return `
                <div class="min-h-full flex items-center justify-center p-6">
                    <div class="bg-white w-full max-w-md p-8 rounded-xl shadow-2xl">
                        <div class="text-center mb-6">
                            <h1 class="text-2xl font-bold text-indigo-600 mb-2">Addis Ababa Science and Technology University</h1>
                            <p class="text-sm text-gray-600 italic mb-4">University for Industry</p>
                            <h2 class="text-xl text-gray-800 font-bold mb-1">Create Account</h2>
                            <p class="text-gray-600 text-sm">Join Room Reservation System</p>
                        </div>
                        
                        <form id="register-form" class="space-y-4">
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Full Name</label>
                                <input type="text" id="register-name" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Email</label>
                                <input type="email" id="register-email" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Password</label>
                                <input type="password" id="register-password" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <input type="hidden" id="register-role" value="student">
                            <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition shadow-lg">
                                Create Account
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center">
                            <button onclick="switchToLogin()" class="text-indigo-600 hover:underline font-medium">
                                Already have an account? Sign In
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdminDashboard() {
            const rooms = getRooms();
            const bookings = getBookings();
            const pendingBookings = bookings.filter(b => b.status === 'pending');
            const approvedBookings = bookings.filter(b => b.status === 'approved');
            const totalUsers = getUsers().length;

            return `
                <div class="w-full h-full overflow-auto">
                    <div class="bg-white border-b border-gray-200 p-4 shadow-sm">
                        <div class="max-w-7xl mx-auto flex justify-between items-center">
                            <div class="flex flex-col">
                                <h1 class="text-xl font-bold text-indigo-600">Addis Ababa Science and Technology University</h1>
                                <p class="text-xs text-gray-600 italic">Room Reservation System</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark/Light Mode">


                                    ${isDarkMode ? '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 1.25a.75.75 0 0 1 .75.75v1a.75.75 0 0 1-1.5 0V2a.75.75 0 0 1 .75-.75"/><path fill="currentColor" fill-rule="evenodd" d="M6.25 12a5.75 5.75 0 1 1 11.5 0a5.75 5.75 0 0 1-11.5 0M12 7.75a4.25 4.25 0 1 0 0 8.5a4.25 4.25 0 0 0 0-8.5" clip-rule="evenodd"/><path fill="currentColor" d="M5.46 4.399a.75.75 0 0 0-1.061 1.06l.707.707a.75.75 0 1 0 1.06-1.06zM22.75 12a.75.75 0 0 1-.75.75h-1a.75.75 0 0 1 0-1.5h1a.75.75 0 0 1 .75.75m-3.149-6.54a.75.75 0 1 0-1.06-1.061l-.707.707a.75.75 0 1 0 1.06 1.06zM12 20.25a.75.75 0 0 1 .75.75v1a.75.75 0 0 1-1.5 0v-1a.75.75 0 0 1 .75-.75m6.894-2.416a.75.75 0 1 0-1.06 1.06l.707.707a.75.75 0 1 0 1.06-1.06zM3.75 12a.75.75 0 0 1-.75.75H2a.75.75 0 0 1 0-1.5h1a.75.75 0 0 1 .75.75m2.416 6.894a.75.75 0 0 0-1.06-1.06l-.707.707a.75.75 0 0 0 1.06 1.06z"/></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M11.486 4.768a7.25 7.25 0 1 0 7.399 9.51a6.25 6.25 0 0 1-7.398-9.51M3.25 12a8.75 8.75 0 0 1 10.074-8.65a.75.75 0 0 1 .336 1.342a4.75 4.75 0 1 0 5.83 7.499a.75.75 0 0 1 1.22.654A8.751 8.751 0 0 1 3.25 12" clip-rule="evenodd"/></svg>'}
                                </div>
                                <span class="text-gray-700 font-medium">üë§ ${currentUser.username}</span>
                                <button onclick="logout()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition text-sm">
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-7xl mx-auto p-6">
                        <!-- Statistics Cards -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div>
                                    <div class="text-gray-700 text-sm font-medium">Total Rooms</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${rooms.length}</div>
                            </div>
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl">‚è≥</div>
                                    <div class="text-gray-700 text-sm font-medium">Pending Requests</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${pendingBookings.length}</div>
                            </div>
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl">‚úÖ</div>
                                    <div class="text-gray-700 text-sm font-medium">Approved Bookings</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${approvedBookings.length}</div>
                            </div>
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl">üë•</div>
                                    <div class="text-gray-700 text-sm font-medium">Total Users</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${totalUsers}</div>
                            </div>
                        </div>

                        <!-- Room Management -->
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl text-gray-800 font-bold">üè¢ Room Management</h2>
                                <button onclick="showAddRoomModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md font-semibold">
                                    ‚ûï Add New Room
                                </button>
                            </div>
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                                ${rooms.length === 0 ? `
                                    <div class="p-8 text-center">
                                        <div class="text-6xl mb-4">üè¢</div>
                                        <div class="text-gray-800 font-semibold mb-2">No rooms added yet</div>
                                        <div class="text-gray-600 text-sm">Click "Add New Room" to get started!</div>
                                    </div>
                                ` : `
                                    <div class="overflow-x-auto">
                                        <table class="w-full">
                                            <thead class="bg-indigo-50">
                                                <tr>
                                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room Name</th>
                                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Building</th>
                                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Floor</th>
                                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Capacity</th>
                                                    <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Equipment</th>
                                                </tr>
                                            </thead>
                                            <tbody class="divide-y divide-gray-200">
                                                ${rooms.map(room => `
                                                    <tr class="hover:bg-gray-50 transition">
                                                        <td class="px-6 py-4">
                                                            <div class="flex items-center gap-3">
                                                                <span class="text-2xl">${room.imageUrl || 'üè¢'}</span>
                                                                <span class="text-gray-800 font-medium">${room.roomName}</span>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700">${room.building || 'N/A'}</td>
                                                        <td class="px-6 py-4 text-gray-700">${room.floor || 'N/A'}</td>
                                                        <td class="px-6 py-4 text-gray-700">üë• ${room.capacity}</td>
                                                        <td class="px-6 py-4 text-gray-700 text-sm">${room.equipment}</td>
                                                    </tr>
                                                `).join('')}
                                            </tbody>
                                        </table>
                                    </div>
                                `}
                            </div>
                        </div>

                        <!-- All Bookings Overview -->
                        <div>
                            <h2 class="text-xl text-gray-800 font-bold mb-6">üì¨ All Reservation Requests</h2>
                            
                            <!-- Pending Requests -->
                            ${pendingBookings.length > 0 ? `
                                <div class="mb-8">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="text-3xl">‚è≥</div>
                                        <h3 class="text-lg text-gray-800 font-bold">Pending Requests (${pendingBookings.length})</h3>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-yellow-200">
                                        <div class="overflow-x-auto">
                                            <table class="w-full">
                                                <thead class="bg-yellow-50">
                                                    <tr>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Attendance</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    ${pendingBookings.map(booking => {
                                                        const room = rooms.find(r => r.id === booking.roomId);
                                                        return `
                                                            <tr class="hover:bg-yellow-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                                <td class="px-6 py-4">
                                                                    <div class="flex items-center gap-2">
                                                                        <span>üéâ</span>
                                                                        <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4">
                                                                    <div class="text-gray-700 text-sm">
                                                                        <div class="font-medium">${booking.studentName}</div>
                                                                        <div class="text-xs text-gray-500">${booking.studentEmail}</div>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                                <td class="px-6 py-4 text-gray-700 text-sm">
                                                                    <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                                    <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">ÔøΩÔøΩÔøΩÔøΩ ${booking.attendance}</td>
                                                                <td class="px-6 py-4">
                                                                    <div class="flex gap-2" onclick="event.stopPropagation()">
                                                                        <button onclick="approveBooking('${booking.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition text-xs font-semibold" title="Approve">
                                                                            ‚úÖ
                                                                        </button>
                                                                        <button onclick="showRejectModal('${booking.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition text-xs font-semibold" title="Reject">
                                                                            ‚ùå
                                                                        </button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        `;
                                                    }).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Approved Bookings -->
                            ${approvedBookings.length > 0 ? `
                                <div class="mb-8">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="text-3xl">‚úÖ</div>
                                        <h3 class="text-lg text-gray-800 font-bold">Approved Bookings (${approvedBookings.length})</h3>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-green-200">
                                        <div class="overflow-x-auto">
                                            <table class="w-full">
                                                <thead class="bg-green-50">
                                                    <tr>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Attendance</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    ${approvedBookings.map(booking => {
                                                        const room = rooms.find(r => r.id === booking.roomId);
                                                        return `
                                                            <tr class="hover:bg-green-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                                <td class="px-6 py-4">
                                                                    <div class="flex items-center gap-2">
                                                                        <span>üéâ</span>
                                                                        <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4">
                                                                    <div class="text-gray-700 text-sm">
                                                                        <div class="font-medium">${booking.studentName}</div>
                                                                        <div class="text-xs text-gray-500">${booking.studentEmail}</div>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                                <td class="px-6 py-4 text-gray-700 text-sm">
                                                                    <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                                    <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">üë• ${booking.attendance}</td>
                                                            </tr>
                                                        `;
                                                    }).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Rejected Requests -->
                            ${bookings.filter(b => b.status === 'rejected').length > 0 ? `
                                <div class="mb-8">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="text-3xl">‚ùå</div>
                                        <h3 class="text-lg text-gray-800 font-bold">Rejected Requests (${bookings.filter(b => b.status === 'rejected').length})</h3>
                                    </div>
                                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-red-200">
                                        <div class="overflow-x-auto">
                                            <table class="w-full">
                                                <thead class="bg-red-50">
                                                    <tr>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                        <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Rejection Reason</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    ${bookings.filter(b => b.status === 'rejected').map(booking => {
                                                        const room = rooms.find(r => r.id === booking.roomId);
                                                        return `
                                                            <tr class="hover:bg-red-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                                <td class="px-6 py-4">
                                                                    <div class="flex items-center gap-2">
                                                                        <span>üéâ</span>
                                                                        <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4">
                                                                    <div class="text-gray-700 text-sm">
                                                                        <div class="font-medium">${booking.studentName}</div>
                                                                        <div class="text-xs text-gray-500">${booking.studentEmail}</div>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                                <td class="px-6 py-4 text-gray-700 text-sm">
                                                                    <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                                    <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700 text-sm max-w-xs truncate" title="${booking.rejectionReason || 'No reason provided'}">${booking.rejectionReason || 'No reason provided'}</td>
                                                            </tr>
                                                        `;
                                                    }).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${pendingBookings.length === 0 && approvedBookings.length === 0 && bookings.filter(b => b.status === 'rejected').length === 0 ? `
                                <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                                    <div class="text-6xl mb-4">üì≠</div>
                                    <div class="text-gray-800 font-semibold mb-2">No booking requests yet</div>
                                    <div class="text-gray-600 text-sm">New reservation requests from students will appear here.</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <div id="modal-container"></div>
            `;
        }

        function renderAdminHome(rooms, bookings, pendingBookings, approvedBookings, rejectedBookings, totalUsers) {
            return `
                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-8">
                    <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-3xl">üè¢</div>
                            <div class="text-gray-700 text-sm font-medium">Total Rooms</div>
                        </div>
                        <div class="text-4xl text-gray-800 font-bold">${rooms.length}</div>
                    </div>
                    <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-3xl">‚è≥</div>
                            <div class="text-gray-700 text-sm font-medium">Pending</div>
                        </div>
                        <div class="text-4xl text-gray-800 font-bold">${pendingBookings.length}</div>
                    </div>
                    <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-3xl">‚úÖ</div>
                            <div class="text-gray-700 text-sm font-medium">Approved</div>
                        </div>
                        <div class="text-4xl text-gray-800 font-bold">${approvedBookings.length}</div>
                    </div>
                    <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-3xl">‚ùå</div>
                            <div class="text-gray-700 text-sm font-medium">Rejected</div>
                        </div>
                        <div class="text-4xl text-gray-800 font-bold">${rejectedBookings.length}</div>
                    </div>
                    <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                        <div class="flex items-center justify-between mb-3">
                            <div class="text-3xl">üë•</div>
                            <div class="text-gray-700 text-sm font-medium">Total Users</div>
                        </div>
                        <div class="text-4xl text-gray-800 font-bold">${totalUsers}</div>
                    </div>
                </div>

                <!-- Recent Pending Requests -->
                ${pendingBookings.length > 0 ? `
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl text-gray-800 font-bold">‚è≥ Recent Pending Requests</h2>
                            <button onclick="setAdminTab('bookings')" class="text-indigo-600 hover:text-indigo-700 font-semibold text-sm">
                                View All ‚Üí
                            </button>
                        </div>
                        <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-yellow-200">
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-yellow-50">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${pendingBookings.slice(0, 5).map(booking => {
                                            const room = rooms.find(r => r.id === booking.roomId);
                                            return `
                                                <tr class="hover:bg-yellow-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                    <td class="px-6 py-4">
                                                        <div class="flex items-center gap-2">
                                                            <span>üéâ</span>
                                                            <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <div class="text-gray-700 text-sm">
                                                            <div class="font-medium">${booking.studentName}</div>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                    <td class="px-6 py-4 text-gray-700 text-sm">
                                                        ${new Date(booking.startTime).toLocaleDateString()}
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <div class="flex gap-2" onclick="event.stopPropagation()">
                                                            <button onclick="approveBooking('${booking.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition text-xs font-semibold">
                                                                ‚úÖ
                                                            </button>
                                                            <button onclick="showRejectModal('${booking.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition text-xs font-semibold">
                                                                ‚ùå
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="bg-white rounded-xl shadow-lg p-8 text-center mb-8">
                        <div class="text-6xl mb-4">‚úÖ</div>
                        <div class="text-gray-800 font-semibold mb-2">All caught up!</div>
                        <div class="text-gray-600 text-sm">No pending requests at the moment.</div>
                    </div>
                `}

                <!-- Quick Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg text-gray-800 font-bold mb-4">üìä Booking Statistics</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Total Bookings</span>
                                <span class="text-gray-800 font-bold">${bookings.length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Approval Rate</span>
                                <span class="text-gray-800 font-bold">${bookings.length > 0 ? Math.round((approvedBookings.length / bookings.length) * 100) : 0}%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Pending Review</span>
                                <span class="text-yellow-600 font-bold">${pendingBookings.length}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg text-gray-800 font-bold mb-4">üè¢ Room Statistics</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Total Rooms</span>
                                <span class="text-gray-800 font-bold">${rooms.length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Currently Booked</span>
                                <span class="text-gray-800 font-bold">${approvedBookings.length}</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Available</span>
                                <span class="text-green-600 font-bold">${rooms.length - approvedBookings.length}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRoomsManagement(rooms) {
            return `
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl text-gray-800 font-bold">Rooms Management</h2>
                        <button onclick="showAddRoomModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md font-semibold">
                            ‚ûï Add New Room
                        </button>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                        ${rooms.length === 0 ? `
                            <div class="p-12 text-center">
                                <div class="text-6xl mb-4"><div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div></div>
                                <div class="text-gray-800 font-semibold text-lg mb-2">No rooms added yet</div>
                                <div class="text-gray-600 text-sm mb-6">Start by adding your first room to the system</div>
                                <button onclick="showAddRoomModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md font-semibold">
                                    ‚ûï Add First Room
                                </button>
                            </div>
                        ` : `
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead class="bg-indigo-50">
                                        <tr>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room Name</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Building</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Floor</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Capacity</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Equipment</th>
                                            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200">
                                        ${rooms.map(room => {
                                            const approvedBookings = getBookings().filter(b => b.status === 'approved');
                                            const isBooked = approvedBookings.some(b => b.roomId === room.id);
                                            return `
                                                <tr class="hover:bg-gray-50 transition">
                                                    <td class="px-6 py-4">
                                                        <div class="flex items-center gap-3">
                                                            <span class="text-2xl">${room.imageUrl || '<div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div>'}</span>
                                                            <span class="text-gray-800 font-medium">${room.roomName}</span>
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4 text-gray-700">${room.building || 'N/A'}</td>
                                                    <td class="px-6 py-4 text-gray-700">${room.floor || 'N/A'}</td>
                                                    <td class="px-6 py-4 text-gray-700">üë• ${room.capacity}</td>
                                                    <td class="px-6 py-4 text-gray-700 text-sm">${room.equipment}</td>
                                                    <td class="px-6 py-4">
                                                        ${isBooked 
                                                            ? '<span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-semibold">üîí Booked</span>'
                                                            : '<span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold">‚úÖ Available</span>'
                                                        }
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderBookingReports(bookings, pendingBookings, approvedBookings, rejectedBookings, rooms) {
            return `
                <div>
                    <h2 class="text-2xl text-gray-800 font-bold mb-6">üìã Booking Reports</h2>
                    
                    <!-- Pending Requests -->
                    ${pendingBookings.length > 0 ? `
                        <div class="mb-8">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="text-3xl">‚è≥</div>
                                <h3 class="text-lg text-gray-800 font-bold">Pending Requests (${pendingBookings.length})</h3>
                            </div>
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-yellow-200">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-yellow-50">
                                            <tr>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Attendance</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${pendingBookings.map(booking => {
                                                const room = rooms.find(r => r.id === booking.roomId);
                                                return `
                                                    <tr class="hover:bg-yellow-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                        <td class="px-6 py-4">
                                                            <div class="flex items-center gap-2">
                                                                <span>üéâ</span>
                                                                <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4">
                                                            <div class="text-gray-700 text-sm">
                                                                <div class="font-medium">${booking.studentName}</div>
                                                                <div class="text-xs text-gray-500">${booking.studentEmail}</div>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                        <td class="px-6 py-4 text-gray-700 text-sm">
                                                            <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                            <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700">üë• ${booking.attendance}</td>
                                                        <td class="px-6 py-4">
                                                            <div class="flex gap-2" onclick="event.stopPropagation()">
                                                                <button onclick="approveBooking('${booking.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition text-xs font-semibold" title="Approve">
                                                                    ‚úÖ
                                                                </button>
                                                                <button onclick="showRejectModal('${booking.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition text-xs font-semibold" title="Reject">
                                                                    ‚ùå
                                                                </button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Approved Bookings -->
                    ${approvedBookings.length > 0 ? `
                        <div class="mb-8">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="text-3xl">‚úÖ</div>
                                <h3 class="text-lg text-gray-800 font-bold">Approved Bookings (${approvedBookings.length})</h3>
                            </div>
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-green-200">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-green-50">
                                            <tr>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Attendance</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${approvedBookings.map(booking => {
                                                const room = rooms.find(r => r.id === booking.roomId);
                                                return `
                                                    <tr class="hover:bg-green-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                        <td class="px-6 py-4">
                                                            <div class="flex items-center gap-2">
                                                                <span>üéâ</span>
                                                                <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4">
                                                            <div class="text-gray-700 text-sm">
                                                                <div class="font-medium">${booking.studentName}</div>
                                                                <div class="text-xs text-gray-500">${booking.studentEmail}</div>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                        <td class="px-6 py-4 text-gray-700 text-sm">
                                                            <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                            <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700">üë• ${booking.attendance}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Rejected Requests -->
                    ${rejectedBookings.length > 0 ? `
                        <div class="mb-8">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="text-3xl">‚ùå</div>
                                <h3 class="text-lg text-gray-800 font-bold">Rejected Requests (${rejectedBookings.length})</h3>
                            </div>
                            <div class="bg-white rounded-xl shadow-lg overflow-hidden border-2 border-red-200">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-red-50">
                                            <tr>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Student</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Room</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-800">Rejection Reason</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${rejectedBookings.map(booking => {
                                                const room = rooms.find(r => r.id === booking.roomId);
                                                return `
                                                    <tr class="hover:bg-red-50 transition cursor-pointer" onclick="showBookingDetails('${booking.id}')">
                                                        <td class="px-6 py-4">
                                                            <div class="flex items-center gap-2">
                                                                <span>üéâ</span>
                                                                <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4">
                                                            <div class="text-gray-700 text-sm">
                                                                <div class="font-medium">${booking.studentName}</div>
                                                                <div class="text-xs text-gray-500">${booking.studentEmail}</div>
                                                            </div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                        <td class="px-6 py-4 text-gray-700 text-sm">
                                                            <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                            <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                        </td>
                                                        <td class="px-6 py-4 text-gray-700 text-sm max-w-xs truncate" title="${booking.rejectionReason || 'No reason provided'}">${booking.rejectionReason || 'No reason provided'}</td>
                                                    </tr>
                                                `;
                                            }).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${pendingBookings.length === 0 && approvedBookings.length === 0 && rejectedBookings.length === 0 ? `
                        <div class="bg-white rounded-xl shadow-lg p-12 text-center">
                            <div class="text-6xl mb-4">üì≠</div>
                            <div class="text-gray-800 font-semibold text-lg mb-2">No booking requests yet</div>
                            <div class="text-gray-600 text-sm">New reservation requests from students will appear here.</div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderStudentDashboard() {
            const allRooms = getRooms();
            const filteredRooms = getFilteredRooms();
            const bookings = getBookings().filter(b => b.studentEmail === currentUser.email);
            const favorites = getFavoriteRooms();
            const buildings = [...new Set(allRooms.map(r => r.building).filter(Boolean))];

            return `
                <div class="w-full h-full overflow-auto">
                    <div class="bg-white border-b border-gray-200 p-4 shadow-sm">
                        <div class="max-w-7xl mx-auto flex justify-between items-center">
                            <div class="flex flex-col">
                                <h1 class="text-xl font-bold text-indigo-600">Addis Ababa Science and Technology University</h1>
                                <p class="text-xs text-gray-600 italic">Room Reservation System</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark/Light Mode">
                                    ${isDarkMode ? '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12 1.25a.75.75 0 0 1 .75.75v1a.75.75 0 0 1-1.5 0V2a.75.75 0 0 1 .75-.75"/><path fill="currentColor" fill-rule="evenodd" d="M6.25 12a5.75 5.75 0 1 1 11.5 0a5.75 5.75 0 0 1-11.5 0M12 7.75a4.25 4.25 0 1 0 0 8.5a4.25 4.25 0 0 0 0-8.5" clip-rule="evenodd"/><path fill="currentColor" d="M5.46 4.399a.75.75 0 0 0-1.061 1.06l.707.707a.75.75 0 1 0 1.06-1.06zM22.75 12a.75.75 0 0 1-.75.75h-1a.75.75 0 0 1 0-1.5h1a.75.75 0 0 1 .75.75m-3.149-6.54a.75.75 0 1 0-1.06-1.061l-.707.707a.75.75 0 1 0 1.06 1.06zM12 20.25a.75.75 0 0 1 .75.75v1a.75.75 0 0 1-1.5 0v-1a.75.75 0 0 1 .75-.75m6.894-2.416a.75.75 0 1 0-1.06 1.06l.707.707a.75.75 0 1 0 1.06-1.06zM3.75 12a.75.75 0 0 1-.75.75H2a.75.75 0 0 1 0-1.5h1a.75.75 0 0 1 .75.75m2.416 6.894a.75.75 0 0 0-1.06-1.06l-.707.707a.75.75 0 0 0 1.06 1.06z"/></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M11.486 4.768a7.25 7.25 0 1 0 7.399 9.51a6.25 6.25 0 0 1-7.398-9.51M3.25 12a8.75 8.75 0 0 1 10.074-8.65a.75.75 0 0 1 .336 1.342a4.75 4.75 0 1 0 5.83 7.499a.75.75 0 0 1 1.22.654A8.751 8.751 0 0 1 3.25 12" clip-rule="evenodd"/></svg>'}
                                </div>
                                <span class="text-gray-700 font-medium">üë§ ${currentUser.username}</span>
                                <button onclick="logout()" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition text-sm">
                                    Logout
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="max-w-7xl mx-auto p-6">
                        <!-- Quick Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl">ÔøΩÔøΩ</div>
                                    <div class="text-gray-700 text-sm font-medium">My Bookings</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${bookings.length}</div>
                            </div>
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl">‚≠ê</div>
                                    <div class="text-gray-700 text-sm font-medium">Favorites</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${favorites.length}</div>
                            </div>
                            <div class="bg-white stat-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between mb-3">
                                    <div class="text-3xl"><div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div></div>
                                    <div class="text-gray-700 text-sm font-medium">Available Rooms</div>
                                </div>
                                <div class="text-4xl text-gray-800 font-bold">${filteredRooms.length}</div>
                            </div>
                        </div>

                        <!-- Search and Filter -->
                        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                            <div class="flex flex-col md:flex-row gap-4">
                                <div class="flex-1">
                                    <input 
                                        type="text" 
                                        id="search-input"
                                        placeholder="üîç Search rooms by name, equipment, or description..." 
                                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"
                                        value="${searchQuery}"
                                        oninput="handleSearch(this.value)"
                                    >
                                </div>
                                <select 
                                    id="building-filter"
                                    class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"
                                    onchange="handleBuildingFilter(this.value)"
                                >
                                    <option value="all">üèõÔ∏è All Buildings</option>
                                    ${buildings.map(b => `
                                        <option value="${b}" ${filterBuilding === b ? 'selected' : ''}>${b}</option>
                                    `).join('')}
                                </select>
                                <select 
                                    id="capacity-filter"
                                    class="px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"
                                    onchange="handleCapacityFilter(this.value)"
                                >
                                    <option value="all">üë• Any Capacity</option>
                                    <option value="10" ${filterCapacity === '10' ? 'selected' : ''}>10+ people</option>
                                    <option value="20" ${filterCapacity === '20' ? 'selected' : ''}>20+ people</option>
                                    <option value="50" ${filterCapacity === '50' ? 'selected' : ''}>50+ people</option>
                                    <option value="100" ${filterCapacity === '100' ? 'selected' : ''}>100+ people</option>
                                </select>
                            </div>
                        </div>

                        <!-- Available Rooms -->
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl text-gray-800 font-bold"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="currentColor" d="M4 3v26h11v-4h2v4h11V3zm2 2h20v22h-7v-4h-6v4H6zm2 2v2h4V7zm6 0v2h4V7zm6 0v2h4V7zM8 11v2h4v-2zm6 0v2h4v-2zm6 0v2h4v-2zM8 15v2h4v-2zm6 0v2h4v-2zm6 0v2h4v-2zM8 19v2h4v-2zm6 0v2h4v-2zm6 0v2h4v-2zM8 23v2h4v-2zm12 0v2h4v-2z"/></svg> Available Rooms (${filteredRooms.length})</h2>
                                <button onclick="showBookingModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md font-semibold">
                                    üìÖ Request Booking
                                </button>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${filteredRooms.length === 0 ? `
                                    <div class="bg-white rounded-xl shadow-lg p-8 col-span-full text-center">
                                        <div class="text-6xl mb-4">üîç</div>
                                        <div class="text-gray-800 font-semibold mb-2">No rooms found</div>
                                        <div class="text-gray-600 text-sm">Try adjusting your search or filters.</div>
                                    </div>
                                ` : filteredRooms.map(room => {
                                    const isFav = isRoomFavorite(room.id);
                                    return `
                                        <div class="bg-white card-hover rounded-xl shadow-lg overflow-hidden">
                                            <div class="room-image flex items-center justify-center text-white text-6xl relative">
                                                ${room.imageUrl || '<div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div>'}
                                                <button 
                                                    onclick="toggleFavorite('${room.id}')"
                                                    class="favorite-btn absolute top-3 right-3 bg-white rounded-full p-2 shadow-lg text-2xl"
                                                >
                                                    ${isFav ? '‚≠ê' : '‚òÜ'}
                                                </button>
                                            </div>
                                            <div class="p-5">
                                                <h3 class="text-lg text-gray-800 font-bold mb-2">${room.roomName}</h3>
                                                <div class="text-gray-700 text-sm space-y-2 mb-4">
                                                    <div class="flex items-center gap-2">
                                                        <span>üë•</span>
                                                        <span><strong>Capacity:</strong> ${room.capacity} people</span>
                                                    </div>
                                                    ${room.building ? `
                                                        <div class="flex items-center gap-2">
                                                            <span>üèõÔ∏è</span>
                                                            <span><strong>Building:</strong> ${room.building}</span>
                                                        </div>
                                                    ` : ''}
                                                    <div class="flex items-center gap-2">
                                                        <span>üõ†Ô∏è</span>
                                                        <span><strong>Equipment:</strong> ${room.equipment}</span>
                                                    </div>
                                                </div>
                                                <button onclick="showBookingModalForRoom('${room.id}')" class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition text-sm font-medium">
                                                    üìÖ Book This Room
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <!-- My Bookings -->
                        <div>
                            <h2 class="text-xl text-gray-800 font-bold mb-4">üìã My Bookings</h2>
                            
                            ${bookings.filter(b => b.status === 'pending').length > 0 ? `
                                <div class="mb-6">
                                    <h3 class="text-lg text-gray-800 font-semibold mb-3">‚è≥ Pending Requests</h3>
                                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                                        <div class="overflow-x-auto">
                                            <table class="w-full">
                                                <thead class="bg-yellow-50">
                                                    <tr>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Room</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    ${bookings.filter(b => b.status === 'pending').map(booking => {
                                                        const room = allRooms.find(r => r.id === booking.roomId);
                                                        return `
                                                            <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="showBookingDetailsStudent('${booking.id}')">
                                                                <td class="px-6 py-4">
                                                                    <div class="flex items-center gap-2">
                                                                        <span>üéâ</span>
                                                                        <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                                <td class="px-6 py-4 text-gray-700 text-sm">
                                                                    <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                                    <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                                </td>
                                                                <td class="px-6 py-4">
                                                                    <span class="bg-yellow-100 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold">‚è≥ Pending</span>
                                                                </td>
                                                            </tr>
                                                        `;
                                                    }).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${bookings.filter(b => b.status === 'approved').length > 0 ? `
                                <div class="mb-6">
                                    <h3 class="text-lg text-gray-800 font-semibold mb-3">‚úÖ Approved Bookings</h3>
                                    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                                        <div class="overflow-x-auto">
                                            <table class="w-full">
                                                <thead class="bg-green-50">
                                                    <tr>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Event Name</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Room</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Date & Time</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Attendance</th>
                                                        <th class="px-6 py-3 text-left text-sm font-semibold text-gray-800">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="divide-y divide-gray-200">
                                                    ${bookings.filter(b => b.status === 'approved').map(booking => {
                                                        const room = allRooms.find(r => r.id === booking.roomId);
                                                        return `
                                                            <tr class="hover:bg-gray-50 transition cursor-pointer" onclick="showBookingDetailsStudent('${booking.id}')">
                                                                <td class="px-6 py-4">
                                                                    <div class="flex items-center gap-2">
                                                                        <span>üéâ</span>
                                                                        <span class="text-gray-800 font-medium">${booking.eventName}</span>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">${room ? room.roomName : 'N/A'}</td>
                                                                <td class="px-6 py-4 text-gray-700 text-sm">
                                                                    <div>${new Date(booking.startTime).toLocaleDateString()}</div>
                                                                    <div class="text-xs text-gray-500">${new Date(booking.startTime).toLocaleTimeString()} - ${new Date(booking.endTime).toLocaleTimeString()}</div>
                                                                </td>
                                                                <td class="px-6 py-4 text-gray-700">üë• ${booking.attendance}</td>
                                                                <td class="px-6 py-4">
                                                                    <span class="bg-green-100 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold">‚úÖ Approved</span>
                                                                </td>
                                                            </tr>
                                                        `;
                                                    }).join('')}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${bookings.filter(b => b.status === 'rejected').length > 0 ? `
                                <div class="mb-6">
                                    <h3 class="text-lg text-gray-800 font-semibold mb-3">‚ùå Rejected Requests</h3>
                                    <div class="space-y-3">
                                        ${bookings.filter(b => b.status === 'rejected').map(booking => {
                                            const room = allRooms.find(r => r.id === booking.roomId);
                                            return `
                                                <div class="bg-white rounded-xl shadow-lg p-6 cursor-pointer hover:shadow-xl transition" onclick="showBookingDetailsStudent('${booking.id}')">
                                                    <div class="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h4 class="text-lg text-gray-800 font-bold mb-2">üéâ ${booking.eventName}</h4>
                                                            <div class="text-gray-700 text-sm space-y-1">
                                                                <div><strong><div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div> Room:</strong> ${room ? room.roomName : 'N/A'}</div>
                                                                <div><strong>üìÖ Start:</strong> ${new Date(booking.startTime).toLocaleString()}</div>
                                                                <div><strong>üïê End:</strong> ${new Date(booking.endTime).toLocaleString()}</div>
                                                            </div>
                                                        </div>
                                                        <span class="bg-red-100 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap">‚ùå Rejected</span>
                                                    </div>
                                                    <div class="mt-4 p-4 bg-red-50 rounded-lg">
                                                        <div class="text-gray-800 font-semibold mb-2">‚ùå Rejection Reason:</div>
                                                        <div class="text-gray-700 text-sm">${booking.rejectionReason || 'No reason provided'}</div>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${bookings.length === 0 ? `
                                <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                                    <div class="text-6xl mb-4">üìÖ</div>
                                    <div class="text-gray-800 font-semibold mb-2">No bookings yet</div>
                                    <div class="text-gray-600 text-sm">Submit your first reservation request to get started!</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>

                <div id="modal-container"></div>
            `;
        }

        function handleSearch(value) {
            searchQuery = value;
            renderCurrentView();
        }

        function handleBuildingFilter(value) {
            filterBuilding = value;
            renderCurrentView();
        }

        function handleCapacityFilter(value) {
            filterCapacity = value;
            renderCurrentView();
        }

        function toggleFavorite(roomId) {
            loadData();
            const existingFav = allData.find(item => 
                item.type === 'favorite' && 
                item.roomId === roomId && 
                item.studentEmail === currentUser.email
            );

            if (existingFav) {
                db.delete(existingFav);
                showToast('Removed from favorites', 'info');
            } else {
                const favData = {
                    id: Date.now().toString() + Math.random(),
                    type: 'favorite',
                    studentEmail: currentUser.email,
                    roomId: roomId,
                    createdAt: new Date().toISOString()
                };
                db.create(favData);
                showToast('Added to favorites', 'success');
            }
            
            loadData();
            renderCurrentView();
        }

        function showAddRoomModal() {
            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 flex items-center justify-center p-4 overflow-auto" style="background-color: rgba(0,0,0,0.5); z-index: 1000;">
                    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl my-8">
                        <h2 class="text-xl text-gray-800 font-bold mb-6">‚ûï Add New Room</h2>
                        <form id="add-room-form" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-gray-700 font-medium block mb-2">Room Name *</label>
                                    <input type="text" id="room-name" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                </div>
                                <div>
                                    <label class="text-gray-700 font-medium block mb-2">Capacity *</label>
                                    <input type="number" id="room-capacity" required min="1" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-gray-700 font-medium block mb-2">Building</label>
                                    <input type="text" id="room-building" placeholder="e.g., Science Hall" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                </div>
                                <div>
                                    <label class="text-gray-700 font-medium block mb-2">Floor</label>
                                    <input type="text" id="room-floor" placeholder="e.g., 2nd Floor" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                </div>
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Equipment *</label>
                                <input type="text" id="room-equipment" required placeholder="e.g., Projector, Whiteboard, Audio System" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Description</label>
                                <textarea id="room-description" rows="3" placeholder="Describe the room features and amenities..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"></textarea>
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Room Icon (emoji)</label>
                                <input type="text" id="room-image" maxlength="2" placeholder="üè¢" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                
                            </div>
                            <div class="flex gap-3 justify-end pt-4">
                                <button type="button" onclick="closeModal()" class="text-gray-700 px-6 py-3 rounded-lg border-2 border-gray-300 hover:bg-gray-50 transition font-medium">
                                    Cancel
                                </button>
                                <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md font-semibold">
                                    Add Room
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.getElementById('add-room-form').addEventListener('submit', handleAddRoom);
        }

        function handleAddRoom(e) {
            e.preventDefault();

            const roomData = {
                id: Date.now().toString() + Math.random(),
                type: 'room',
                roomName: document.getElementById('room-name').value,
                capacity: parseInt(document.getElementById('room-capacity').value),
                equipment: document.getElementById('room-equipment').value,
                description: document.getElementById('room-description').value,
                building: document.getElementById('room-building').value,
                floor: document.getElementById('room-floor').value,
                imageUrl: document.getElementById('room-image').value,
                createdAt: new Date().toISOString()
            };

            db.create(roomData);
            showToast('Room added successfully!', 'success');
            closeModal();
            loadData();
            renderCurrentView();
        }

        function showBookingModal() {
            showBookingModalForRoom(null);
        }

        function showBookingModalForRoom(preselectedRoomId) {
            const rooms = getFilteredRooms();
            if (rooms.length === 0) {
                showToast('No rooms available for booking', 'error');
                return;
            }

            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 flex items-center justify-center p-4 overflow-auto" style="background-color: rgba(0,0,0,0.5); z-index: 1000;">
                    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-2xl my-8">
                        <h2 class="text-xl text-gray-800 font-bold mb-6">üìÖ Request Room Booking</h2>
                        <form id="booking-form" class="space-y-4">
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Event Name *</label>
                                <input type="text" id="event-name" required placeholder="e.g., Computer Science Club Meeting" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Select Room *</label>
                                <select id="room-select" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                    <option value="">Choose a room</option>
                                    ${rooms.map(room => `
                                        <option value="${room.id}" ${preselectedRoomId === room.id ? 'selected' : ''}>
                                            ${room.roomName} (Capacity: ${room.capacity})${room.building ? ` - ${room.building}` : ''}
                                        </option>
                                    `).join('')}
                                </select>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="text-gray-700 font-medium block mb-2">Start Date & Time *</label>
                                    <input type="datetime-local" id="start-time" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                </div>
                                <div>
                                    <label class="text-gray-700 font-medium block mb-2">End Date & Time *</label>
                                    <input type="datetime-local" id="end-time" required class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                                </div>
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Expected Attendance *</label>
                                <input type="number" id="attendance" required min="1" placeholder="Number of attendees" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition">
                            </div>
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Event Proposal *</label>
                                <textarea id="event-proposal" required rows="4" placeholder="Describe the purpose and details of your event" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"></textarea>
                            </div>
                            <div class="flex gap-3 justify-end pt-4">
                                <button type="button" onclick="closeModal()" class="text-gray-700 px-6 py-3 rounded-lg border-2 border-gray-300 hover:bg-gray-50 transition font-medium">
                                    Cancel
                                </button>
                                <button type="submit" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition shadow-md font-semibold">
                                    Submit Request
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.getElementById('booking-form').addEventListener('submit', handleBookingSubmit);
        }

        function handleBookingSubmit(e) {
            e.preventDefault();

            const startTimeValue = document.getElementById('start-time').value;
            const endTimeValue = document.getElementById('end-time').value;
            
            if (!startTimeValue || !endTimeValue) {
                showToast('Please select both start and end times', 'error');
                return;
            }

            const bookingData = {
                id: Date.now().toString() + Math.random(),
                type: 'booking',
                studentEmail: currentUser.email,
                studentName: currentUser.username,
                roomId: document.getElementById('room-select').value,
                eventName: document.getElementById('event-name').value,
                startTime: new Date(startTimeValue).toISOString(),
                endTime: new Date(endTimeValue).toISOString(),
                attendance: parseInt(document.getElementById('attendance').value),
                eventProposal: document.getElementById('event-proposal').value,
                status: 'pending',
                rejectionReason: '',
                createdAt: new Date().toISOString()
            };

            db.create(bookingData);
            showToast('Booking request submitted successfully! Awaiting admin approval.', 'success');
            closeModal();
            loadData();
            renderCurrentView();
        }

        function approveBooking(bookingId) {
            loadData();
            const booking = allData.find(b => b.id === bookingId);
            if (!booking) return;

            const room = getRooms().find(r => r.id === booking.roomId);
            const roomName = room ? room.roomName : 'the room';

            const updatedBooking = { ...booking, status: 'approved' };
            db.update(updatedBooking);
            showToast(`Booking approved! ${roomName} is now reserved and removed from available rooms.`, 'success');
            
            loadData();
            renderCurrentView();
        }

        function showBookingDetails(bookingId) {
            loadData();
            const booking = allData.find(b => b.id === bookingId);
            if (!booking) return;

            const rooms = getRooms();
            const room = rooms.find(r => r.id === booking.roomId);

            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 flex items-center justify-center p-4 overflow-auto" style="background-color: rgba(0,0,0,0.5); z-index: 1000;">
                    <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-3xl my-8">
                        <div class="flex justify-between items-start mb-6">
                            <h2 class="text-2xl text-gray-800 font-bold">üìã Booking Request Details</h2>
                            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">√ó</button>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="bg-indigo-50 p-6 rounded-lg">
                                <h3 class="text-xl text-gray-800 font-bold mb-4">üéâ ${booking.eventName}</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                                    <div>
                                        <div class="font-semibold mb-1">üë§ Student Information</div>
                                        <div class="text-sm">${booking.studentName}</div>
                                        <div class="text-sm text-gray-600">${booking.studentEmail}</div>
                                    </div>
                                    <div>
                                        <div class="font-semibold mb-1 flex items-center gap-2">
  <img src="icons/building-outline.png" class="w-4 h-4 opacity-80">
  Requested Room
</div>

                                        <div class="text-sm">${room ? room.roomName : 'N/A'}</div>
                                        ${room ? `<div class="text-sm text-gray-600">${room.building || ''} ${room.floor ? '- ' + room.floor : ''}</div>` : ''}
                                    </div>
                                </div>
                            </div>

                            <div class="bg-blue-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-3">üìÖ Event Schedule</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 text-sm">
                                    <div>
                                        <div class="font-medium">Start Time</div>
                                        <div>${new Date(booking.startTime).toLocaleString()}</div>
                                    </div>
                                    <div>
                                        <div class="font-medium">End Time</div>
                                        <div>${new Date(booking.endTime).toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="font-medium">Expected Attendance</div>
                                    <div>üë• ${booking.attendance} people</div>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-3">üìù Event Proposal</h4>
                                <p class="text-gray-700 text-sm leading-relaxed">${booking.eventProposal}</p>
                            </div>

                            ${booking.documentName ? `
                                <div class="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                                    <h4 class="font-semibold text-gray-800 mb-3">üìé Supporting Document</h4>
                                    <div class="flex items-center gap-3">
                                        <span class="text-3xl">üìÑ</span>
                                        <div>
                                            <div class="text-gray-800 font-medium">${booking.documentName}</div>
                                            <div class="text-xs text-gray-600">Document attached to this booking request</div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}

                            <div class="flex gap-3 justify-end pt-4 border-t">
                                <button onclick="closeModal()" class="text-gray-700 px-6 py-3 rounded-lg border-2 border-gray-300 hover:bg-gray-50 transition font-medium">
                                    Close
                                </button>
                                <button onclick="closeModal(); showRejectModal('${booking.id}')" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition font-semibold shadow-md">
                                    ‚ùå Reject Request
                                </button>
                                <button onclick="closeModal(); approveBooking('${booking.id}')" class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition font-semibold shadow-md">
                                    ‚úÖ Approve Request
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showBookingDetailsStudent(bookingId) {
            loadData();
            const booking = allData.find(b => b.id === bookingId);
            if (!booking) return;

            const rooms = getRooms();
            const room = rooms.find(r => r.id === booking.roomId);

            // Get status badge HTML
            let statusBadge = '';
            if (booking.status === 'pending') {
                statusBadge = '<span class="bg-yellow-100 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold">‚è≥ Pending</span>';
            } else if (booking.status === 'approved') {
                statusBadge = '<span class="bg-green-100 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold">‚úÖ Approved</span>';
            } else if (booking.status === 'rejected') {
                statusBadge = '<span class="bg-red-100 text-gray-800 px-4 py-2 rounded-full text-sm font-semibold">‚ùå Rejected</span>';
            }

            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 flex items-center justify-center p-4 overflow-auto" style="background-color: rgba(0,0,0,0.5); z-index: 1000;">
                    <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-3xl my-8">
                        <div class="flex justify-between items-start mb-6">
                            <h2 class="text-2xl text-gray-800 font-bold">üìã Booking Details</h2>
                            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">√ó</button>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="bg-indigo-50 p-6 rounded-lg">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="text-xl text-gray-800 font-bold">üéâ ${booking.eventName}</h3>
                                    ${statusBadge}
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                                    <div>
                                        <div class="font-semibold mb-1">üë§ Organizer</div>
                                        <div class="text-sm">${booking.studentName}</div>
                                        <div class="text-sm text-gray-600">${booking.studentEmail}</div>
                                    </div>
                                    <div>
                                        <div class="font-semibold mb-1"><div class="text-3xl"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 15 15"><path fill="currentColor" d="M7 4.17V1l2-1l2 1l2-1v3l-2 1l-2-1l-1 .5v.67L13.5 6v1h-12V6zM2.5 7.5h10V12l1 1v1h-12v-1l1-1zm1.5 1v4h1v-4zm3 0v4h1v-4zm3 0v4h1v-4z"/></svg></div> Room</div>
                                        <div class="text-sm">${room ? room.roomName : 'N/A'}</div>
                                        ${room ? `<div class="text-sm text-gray-600">${room.building || ''} ${room.floor ? '- ' + room.floor : ''}</div>` : ''}
                                    </div>
                                </div>
                            </div>

                            <div class="bg-blue-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-3">üìÖ Event Schedule</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 text-sm">
                                    <div>
                                        <div class="font-medium">Start Time</div>
                                        <div>${new Date(booking.startTime).toLocaleString()}</div>
                                    </div>
                                    <div>
                                        <div class="font-medium">End Time</div>
                                        <div>${new Date(booking.endTime).toLocaleString()}</div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="font-medium">Expected Attendance</div>
                                    <div>üë• ${booking.attendance} people</div>
                                </div>
                            </div>

                            <div class="bg-gray-50 p-6 rounded-lg">
                                <h4 class="font-semibold text-gray-800 mb-3">üìù Event Proposal</h4>
                                <p class="text-gray-700 text-sm leading-relaxed">${booking.eventProposal}</p>
                            </div>

                            ${booking.documentName ? `
                                <div class="bg-blue-50 p-6 rounded-lg border-2 border-blue-200">
                                    <h4 class="font-semibold text-gray-800 mb-3">üìé Supporting Document</h4>
                                    <div class="flex items-center gap-3">
                                        <span class="text-3xl">üìÑ</span>
                                        <div>
                                            <div class="text-gray-800 font-medium">${booking.documentName}</div>
                                            <div class="text-xs text-gray-600">Document attached to this booking request</div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}

                            ${booking.status === 'rejected' && booking.rejectionReason ? `
                                <div class="bg-red-50 p-6 rounded-lg border-2 border-red-200">
                                    <h4 class="font-semibold text-gray-800 mb-3">‚ùå Rejection Reason</h4>
                                    <p class="text-gray-700 text-sm leading-relaxed">${booking.rejectionReason}</p>
                                </div>
                            ` : ''}

                            <div class="flex justify-end pt-4 border-t">
                                <button onclick="closeModal()" class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-semibold">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showRejectModal(bookingId) {
            const modal = document.getElementById('modal-container');
            modal.innerHTML = `
                <div class="fixed inset-0 flex items-center justify-center p-4" style="background-color: rgba(0,0,0,0.5); z-index: 1000;">
                    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md">
                        <h2 class="text-xl text-gray-800 font-bold mb-6">‚ùå Reject Booking Request</h2>
                        <form id="reject-form" class="space-y-4">
                            <div>
                                <label class="text-gray-700 font-medium block mb-2">Rejection Reason (Required) *</label>
                                <textarea id="rejection-reason" required rows="4" placeholder="Please provide a clear reason for rejection" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"></textarea>
                            </div>
                            <div class="flex gap-3 justify-end pt-4">
                                <button type="button" onclick="closeModal()" class="text-gray-700 px-6 py-3 rounded-lg border-2 border-gray-300 hover:bg-gray-50 transition font-medium">
                                    Cancel
                                </button>
                                <button type="submit" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition shadow-md font-semibold">
                                    Reject Booking
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;

            document.getElementById('reject-form').addEventListener('submit', (e) => {
                e.preventDefault();
                handleRejectBooking(bookingId);
            });
        }

        function handleRejectBooking(bookingId) {
            loadData();
            const booking = allData.find(b => b.id === bookingId);
            if (!booking) return;

            const reason = document.getElementById('rejection-reason').value;
            if (!reason.trim()) {
                showToast('Please provide a rejection reason', 'error');
                return;
            }

            const updatedBooking = { 
                ...booking, 
                status: 'rejected',
                rejectionReason: reason
            };

            db.update(updatedBooking);
            showToast('Booking rejected', 'info');
            closeModal();
            loadData();
            renderCurrentView();
        }

        function closeModal() {
            document.getElementById('modal-container').innerHTML = '';
        }

        function handleLogin(e) {
            e.preventDefault();

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            // Check for hardcoded admin account
            if (email === 'aastu@edu.et' && password === 'aastu') {
                currentUser = {
                    id: 'admin-aastu',
                    username: 'AASTU Administrator',
                    email: 'aastu@edu.et',
                    role: 'admin'
                };
                currentView = 'admin';
                showToast('Welcome, AASTU Administrator!', 'success');
                renderCurrentView();
                return;
            }

            // Check for regular student users
            loadData();
            const user = getUsers().find(u => u.email === email && u.password === password && u.role === 'student');

            if (user) {
                currentUser = user;
                currentView = 'student';
                showToast(`Welcome back, ${user.username}!`, 'success');
                renderCurrentView();
            } else {
                showToast('Invalid email or password', 'error');
            }
        }

        function handleRegister(e) {
            e.preventDefault();

            const username = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const role = document.getElementById('register-role').value;

            loadData();
            const existingUser = getUsers().find(u => u.email === email);
            if (existingUser) {
                showToast('Email already registered', 'error');
                return;
            }

            const userData = {
                id: Date.now().toString() + Math.random(),
                type: 'user',
                username,
                email,
                password,
                role,
                createdAt: new Date().toISOString()
            };

            db.create(userData);
            showToast('Registration successful! Please sign in.', 'success');
            currentView = 'login';
            renderCurrentView();
        }

        function switchToRegister() {
            currentView = 'register';
            renderCurrentView();
        }

        function switchToLogin() {
            currentView = 'login';
            renderCurrentView();
        }

        function logout() {
            currentUser = null;
            currentView = 'login';
            searchQuery = '';
            filterBuilding = 'all';
            filterCapacity = 'all';
            sortBy = 'name';
            showToast('Logged out successfully', 'info');
            renderCurrentView();
        }

        // Event delegation
        document.addEventListener('submit', (e) => {
            e.preventDefault();
            
            if (e.target.id === 'login-form') {
                handleLogin(e);
            } else if (e.target.id === 'register-form') {
                handleRegister(e);
            } else if (e.target.id === 'add-room-form') {
                handleAddRoom(e);
            } else if (e.target.id === 'booking-form') {
                handleBookingSubmit(e);
            }
        });

        // Initialize with sample data
        function initializeApp() {
            loadData();
            loadThemePreference();
            
            // Add sample rooms if none exist
            if (getRooms().length === 0) {
                const sampleRooms = [
                    {
                        id: 'room-1',
                        type: 'room',
                        roomName: 'Old Graduation Hall',
                        capacity: 500,
                        equipment: 'Stage, Sound System, Projector, Lighting',
                        description: 'Historic graduation hall with traditional architecture',
                        building: 'Main Building',
                        floor: '1st Floor',
                        imageUrl: 'üéì',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'room-2',
                        type: 'room',
                        roomName: 'New Graduation Hall',
                        capacity: 800,
                        equipment: 'LED Screen, Advanced Audio System, Stage',
                        description: 'Modern graduation hall with state-of-the-art facilities',
                        building: 'Convention Center',
                        floor: 'Ground Floor',
                        imageUrl: 'üèõÔ∏è',
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 'room-3',
                        type: 'room',
                        roomName: 'Engineering Auditorium',
                        capacity: 300,
                        equipment: 'Projector, Microphone, Whiteboard',
                        description: 'Tiered seating auditorium',
                        building: 'Engineering Block',
                        floor: '2nd Floor',
                        imageUrl: '‚öôÔ∏è',
                        createdAt: new Date().toISOString()
                    }
                ];

                sampleRooms.forEach(room => db.create(room));
                loadData();
            }
            
            renderCurrentView();
        }

        initializeApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ae5cd7bb50cd821',t:'MTc2NTgwMDI1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>